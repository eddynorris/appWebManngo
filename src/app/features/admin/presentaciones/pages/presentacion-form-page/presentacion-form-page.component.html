<div class="form-page-container">
  <div class="page-header">
    <h1>
      @if (isViewMode()) {
        Ver Presentación
      } @else if (isEditMode()) {
        Editar Presentación
      } @else {
        Crear Nueva Presentación
      }
    </h1>
    <p>
      @if (isViewMode()) {
        Información detallada de la presentación seleccionada.
      } @else if (isEditMode()) {
        Modifica la información de la presentación existente.
      } @else {
        Completa los datos para registrar una nueva presentación de producto.
      }
    </p>
  </div>

  <form [formGroup]="presentacionForm" (ngSubmit)="onSubmit()" class="data-form" novalidate>
    <!-- SECCIÓN DE INFORMACIÓN BÁSICA -->
    <div class="form-section">
      <h2 class="section-title">Información de la Presentación</h2>
      <div class="form-grid two-cols">
        <div class="input-group">
          <label for="producto_id">Producto *</label>
          <select id="producto_id" formControlName="producto_id">
            <option value="" disabled>Selecciona un producto</option>
            @if (productos().length > 0) {
              @for (producto of productos(); track producto.id) {
                <option [value]="producto.id">{{ producto.nombre }}</option>
              }
            }
          </select>
          @if (getFieldError('producto_id')) {
            <span class="error-message">{{ getFieldError('producto_id') }}</span>
          }
        </div>

        <div class="input-group">
          <label for="nombre">Nombre de la Presentación *</label>
          <input 
            id="nombre" 
            type="text" 
            formControlName="nombre" 
            placeholder="Ej: Carbón Premium 25kg">
          @if (getFieldError('nombre')) {
            <span class="error-message">{{ getFieldError('nombre') }}</span>
          }
        </div>

        <div class="input-group">
          <label for="capacidad_kg">Capacidad (kg) *</label>
          <input 
            id="capacidad_kg" 
            type="number" 
            step="0.01"
            min="0.01"
            formControlName="capacidad_kg" 
            placeholder="0.00">
          @if (getFieldError('capacidad_kg')) {
            <span class="error-message">{{ getFieldError('capacidad_kg') }}</span>
          }
        </div>

        <div class="input-group">
          <label for="tipo">Tipo de Presentación *</label>
          <select id="tipo" formControlName="tipo">
            <option value="" disabled>Selecciona un tipo</option>
            @for (tipo of tiposDisponibles; track tipo.value) {
              <option [value]="tipo.value">{{ tipo.label }}</option>
            }
          </select>
          @if (getFieldError('tipo')) {
            <span class="error-message">{{ getFieldError('tipo') }}</span>
          }
        </div>

        <div class="input-group">
          <label for="precio_venta">Precio de Venta *</label>
          <input 
            id="precio_venta" 
            type="number" 
            step="0.01"
            min="0.01"
            formControlName="precio_venta" 
            placeholder="0.00">
          @if (getFieldError('precio_venta')) {
            <span class="error-message">{{ getFieldError('precio_venta') }}</span>
          }
        </div>

        <div class="input-group">
          <label for="url_foto">URL de Foto (opcional)</label>
          <input 
            id="url_foto" 
            type="text" 
            formControlName="url_foto" 
            placeholder="https://ejemplo.com/imagen.jpg">
          @if (getFieldError('url_foto')) {
            <span class="error-message">{{ getFieldError('url_foto') }}</span>
          }
        </div>
      </div>
    </div>

    <!-- SECCIÓN DE INVENTARIO -->
    @if (!isEditMode() && !isViewMode()) {
      <div class="form-section">
        <h2 class="section-title">Configuración de Inventario</h2>
        <div class="form-grid">
          <div class="input-group">
            <label for="almacen_id">Almacén Específico (opcional)</label>
            <select id="almacen_id" formControlName="almacen_id">
              <option value="">Crear inventario en todos los almacenes</option>
              @if (almacenes().length > 0) {
                @for (almacen of almacenes(); track almacen.id) {
                  <option [value]="almacen.id">{{ almacen.nombre }}</option>
                }
              }
            </select>
            <small class="help-text">
              Si seleccionas un almacén específico, el inventario se creará solo en ese almacén. 
              Si no seleccionas ninguno, se creará inventario en todos los almacenes existentes.
            </small>
            @if (getFieldError('almacen_id')) {
              <span class="error-message">{{ getFieldError('almacen_id') }}</span>
            }
          </div>
        </div>
      </div>
    }

    <!-- SECCIÓN DE ESTADO -->
    <div class="form-section">
      <h2 class="section-title">Estado de la Presentación</h2>
      <div class="form-grid">
        <div class="input-group">
          <div class="checkbox-group">
            <input 
              id="activo" 
              type="checkbox" 
              formControlName="activo">
            <label for="activo">Presentación activa</label>
          </div>
          <small class="help-text">
            Las presentaciones inactivas no aparecerán en las listas de selección.
          </small>
        </div>
      </div>
    </div>

    <!-- SECCIÓN DE ACCIONES -->
    <div class="form-actions">
      <button type="button" (click)="cancel()" class="btn-ghost">Cancelar</button>
      
      @if (isViewMode()) {
        <button type="button" (click)="edit()" class="btn-primary">
          Editar Presentación
        </button>
      } @else {
        <button type="submit" class="btn-primary" [disabled]="presentacionForm.invalid || isLoading()">
          @if (isLoading()) {
            <div class="spinner-small"></div>
          }
          {{ isEditMode() ? 'Actualizar Presentación' : 'Crear Presentación' }}
        </button>
      }
    </div>
  </form>
</div>