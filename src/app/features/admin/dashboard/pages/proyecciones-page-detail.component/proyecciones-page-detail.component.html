<div class="detail-container">
  <!-- Loading State -->
  @if (isLoading()) {
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <p>Cargando información del cliente...</p>
    </div>
  }
  
  <!-- Content -->
  @if (clienteProyeccion(); as cliente) {
    <!-- Header -->
    <div class="detail-header">
      <div class="header-actions">
        <button (click)="goBack()" class="back-btn">
          <fa-icon [icon]="faArrowLeft"></fa-icon>
          Volver a Proyecciones
        </button>
      </div>
      
      <div class="header-content">
        <div class="client-info">
          <div class="client-avatar">
            <fa-icon [icon]="faUser"></fa-icon>
          </div>
          <div class="client-details">
            <h1>{{ cliente.nombre }}</h1>
            <p class="client-id">Cliente #{{ cliente.id }}</p>
          </div>
        </div>
        
        <div class="next-purchase-card" [class]="getUrgenciaClass()">
          <div class="card-icon">
            <fa-icon [icon]="faCalendarAlt"></fa-icon>
          </div>
          <div class="card-content">
            <h3>Próxima Compra Estimada</h3>
            <p class="date">{{ formatDate(cliente.proxima_compra_estimada) }}</p>
            <p class="urgency">{{ getUrgenciaText() }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="detail-content">
      <!-- Contact Information -->
      <div class="info-section">
        <h2>
          <fa-icon [icon]="faUser"></fa-icon>
          Información de Contacto
        </h2>
        <div class="info-grid">
          <div class="info-item">
            <fa-icon [icon]="faEnvelope"></fa-icon>
            <div class="info-content">
              <label>Email</label>
              <span>{{ cliente.email || 'No disponible' }}</span>
            </div>
          </div>
          <div class="info-item">
            <fa-icon [icon]="faPhone"></fa-icon>
            <div class="info-content">
              <label>Teléfono</label>
              <span>{{ cliente.telefono || 'No disponible' }}</span>
            </div>
          </div>
          <div class="info-item">
            <fa-icon [icon]="faMapMarkerAlt"></fa-icon>
            <div class="info-content">
              <label>Dirección</label>
              <span>{{ cliente.direccion || 'No disponible' }}</span>
            </div>
          </div>
          <div class="info-item">
            <fa-icon [icon]="faMapMarkerAlt"></fa-icon>
            <div class="info-content">
              <label>Ciudad</label>
              <span>{{ cliente.ciudad || 'No disponible' }}</span>
            </div>
          </div>
          @if (cliente.pais) {
            <div class="info-item">
              <fa-icon [icon]="faMapMarkerAlt"></fa-icon>
              <div class="info-content">
                <label>País</label>
                <span>{{ cliente.pais }}</span>
              </div>
            </div>
          }
          @if (cliente.codigo_postal) {
            <div class="info-item">
              <fa-icon [icon]="faMapMarkerAlt"></fa-icon>
              <div class="info-content">
                <label>Código Postal</label>
                <span>{{ cliente.codigo_postal }}</span>
              </div>
            </div>
          }
        </div>
      </div>

      <!-- Purchase Pattern -->
      <div class="info-section">
        <h2>
          <fa-icon [icon]="faChartLine"></fa-icon>
          Patrón de Compras
        </h2>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value">{{ cliente.frecuencia_compra_dias }}</div>
            <div class="stat-label">Días entre compras</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">{{ formatDate(cliente.ultima_fecha_compra) }}</div>
            <div class="stat-label">Última compra</div>
          </div>
          <div class="stat-card" [class.warning]="cliente.saldo_pendiente > 0">
            <div class="stat-value">{{ formatCurrency(cliente.saldo_pendiente) }}</div>
            <div class="stat-label">Saldo pendiente</div>
          </div>
        </div>
      </div>

      <!-- Statistics -->
      <div class="info-section">
        <h2>
          <fa-icon [icon]="faDollarSign"></fa-icon>
          Estadísticas de Ventas
        </h2>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value">{{ cliente.estadisticas.total_ventas }}</div>
            <div class="stat-label">Total de ventas</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">{{ formatCurrency(cliente.estadisticas.monto_total_comprado) }}</div>
            <div class="stat-label">Monto total comprado</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">{{ formatCurrency(cliente.estadisticas.promedio_compra) }}</div>
            <div class="stat-label">Promedio por compra</div>
          </div>
        </div>
      
      </div>

      <!-- Recent Sales -->
      @if (cliente.ventas && cliente.ventas.length > 0) {
        <div class="info-section">
          <h2>
            <fa-icon [icon]="faShoppingCart"></fa-icon>
            Historial de Ventas
          </h2>
          <div class="table-container">
            <app-data-table
              [data]="cliente.ventas"
              [columns]="ventasColumns"
              [actions]="ventasActions"
              [isLoading]="isLoading()"
              (onAction)="handleVentasTableAction($event)">
            </app-data-table>
          </div>
        </div>
      } @else if (!isLoading()) {
        <div class="info-section">
          <h2>
            <fa-icon [icon]="faShoppingCart"></fa-icon>
            Ventas Recientes
          </h2>
          <div class="no-data">
            <p>No hay ventas registradas para este cliente.</p>
          </div>
        </div>
      }
    </div>
  }
</div>

<!-- Modal de Detalle de Venta -->
@if (selectedVenta() && ventaDetalleVisible()) {
  <app-venta-detalle-modal
    [venta]="selectedVenta()!"
    [visible]="ventaDetalleVisible"
    (close)="closeVentaDetail()">
  </app-venta-detalle-modal>
}