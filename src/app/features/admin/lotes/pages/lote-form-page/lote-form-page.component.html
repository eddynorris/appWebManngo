<div class="form-page-container">
  <div class="page-header">
    <h1>
      @if (isViewMode()) {
        Ver Lote
      } @else if (isEditMode()) {
        Editar Lote
      } @else {
        Crear Nuevo Lote
      }
    </h1>
    <p>
      @if (isViewMode()) {
        Información detallada del lote seleccionado.
      } @else if (isEditMode()) {
        Modifica la información del lote existente.
      } @else {
        Completa los datos para registrar un nuevo lote en el sistema.
      }
    </p>
  </div>

  <form [formGroup]="loteForm" (ngSubmit)="onSubmit()" class="data-form" novalidate>
    <!-- SECCIÓN DE DATOS PRINCIPALES -->
    <div class="form-section">
      <h2 class="section-title">Información del Lote</h2>
      <div class="form-grid two-cols">
        <div class="input-group">
          <label for="producto_id">Producto *</label>
          <select id="producto_id" formControlName="producto_id">
            <option value="" disabled>Selecciona un producto</option>
            @if (productos().length > 0) {
              @for (producto of productos(); track producto.id) {
                <option [value]="producto.id">{{ producto.nombre }}</option>
              }
            }
          </select>
          @if (getFieldError('producto_id')) {
            <span class="error-message">{{ getFieldError('producto_id') }}</span>
          }
        </div>

        <div class="input-group">
          <label for="proveedor_id">Proveedor *</label>
          <select id="proveedor_id" formControlName="proveedor_id">
            <option value="" disabled>Selecciona un proveedor</option>
            @if (proveedores().length > 0) {
              @for (proveedor of proveedores(); track proveedor.id) {
                <option [value]="proveedor.id">{{ proveedor.nombre }}</option>
              }
            }
          </select>
          @if (getFieldError('proveedor_id')) {
            <span class="error-message">{{ getFieldError('proveedor_id') }}</span>
          }
        </div>

        <div class="input-group full-width">
          <label for="descripcion">Descripción *</label>
          <textarea 
            id="descripcion" 
            formControlName="descripcion" 
            rows="3"
            placeholder="Describe las características del lote"></textarea>
          @if (getFieldError('descripcion')) {
            <span class="error-message">{{ getFieldError('descripcion') }}</span>
          }
        </div>
      </div>
    </div>

    <!-- SECCIÓN DE PESOS Y CANTIDADES -->
    <div class="form-section">
      <h2 class="section-title">Pesos y Cantidades</h2>
      <div class="form-grid three-cols">
        <div class="input-group">
          <label for="peso_humedo_kg">Peso Húmedo (kg) *</label>
          <input 
            id="peso_humedo_kg" 
            type="number" 
            step="0.01"
            min="0.01"
            formControlName="peso_humedo_kg" 
            placeholder="0.00">
          @if (getFieldError('peso_humedo_kg')) {
            <span class="error-message">{{ getFieldError('peso_humedo_kg') }}</span>
          }
        </div>

        <div class="input-group">
          <label for="peso_seco_kg">Peso Seco (kg) *</label>
          <input 
            id="peso_seco_kg" 
            type="number" 
            step="0.01"
            min="0.01"
            formControlName="peso_seco_kg" 
            placeholder="0.00">
          @if (getFieldError('peso_seco_kg')) {
            <span class="error-message">{{ getFieldError('peso_seco_kg') }}</span>
          }
        </div>

        <div class="input-group">
          <label for="cantidad_disponible_kg">Cantidad Disponible (kg) *</label>
          <input 
            id="cantidad_disponible_kg" 
            type="number" 
            step="0.01"
            min="0"
            formControlName="cantidad_disponible_kg" 
            placeholder="0.00">
          @if (getFieldError('cantidad_disponible_kg')) {
            <span class="error-message">{{ getFieldError('cantidad_disponible_kg') }}</span>
          }
        </div>
      </div>
    </div>

    <!-- SECCIÓN DE ACCIONES -->
    <div class="form-actions">
      <button type="button" (click)="cancel()" class="btn-ghost">Cancelar</button>
      
      @if (isViewMode()) {
        <button type="button" (click)="edit()" class="btn-primary">
          Editar Lote
        </button>
      } @else {
        <button type="submit" class="btn-primary" [disabled]="loteForm.invalid || isLoading()">
          @if (isLoading()) {
            <div class="spinner-small"></div>
          }
          {{ isEditMode() ? 'Actualizar Lote' : 'Crear Lote' }}
        </button>
      }
    </div>
  </form>
</div>